# 7장 데이터베이스 언어 SQL

## 1. SQL (Structured Query Langauge)

관계 DB를 위한 표준 질의어 (구조화된 질의어)
비절차적 데이터 언어

### 사용 방식

대화식 SQL : DBMS에 직접 접근해 질의를 작성하여 실행
삽입 SQL : 프로그래밍 언어로 작성된 응용 프로그램에 삽입 😮예) php 언어

### 분류

- 데이터 정의어(DDL) : 테이블 생성, 변경, 제거 기능 제공
- 데이터 조작어(DML) : 데이터 삽입, 수정, 삭제 검색 기능 제공
- 데이터 제어어(DCL) : 보안을 위한 접근 사용 권한 사용자 별로 부여하거나 취소하는 기능 제공 

## 2. SQL의 데이터 정의 기능

### 테이블 생성 : CREATE TABLE 문

- []의 내용은 `옵션`으로 생략 가능하다.
- SQL 질의문은 세미콜론(;)으로 문장 끝을 표시한다.
- ⭐SQL 질의문은 대소문자 구분이 없다.

#### 속성의 정의

- 테이블 구성하는 각 속성의 데이터 타입을 선택한 다음 널 값 허용 여부와 기본 값 필요 여부 결정
- NOT NULL
  - 속성이 널 값을 허용하지 않음을 의미하는 키워드
  - 예) 고객아이디 VARCHAR(20) NOT NULL
- DEFAULT
  - 속성의 기본 값을 지정하는 키워드
  - 예) 적립금 INT DEFAULT 0
  - 예) 담당자 VARCHAR(10) DEFAULT ‘방경아’

🚨 문자열이나 날짜 데이터는 ''로 묶어서 표현 (''로 묶여진 문자열은 대소문자 구분함!)

#### 속성 데이터 타입

#### 키의 정의

- PRIMARY KEY (기본키)
  
  - 널 값을 허용하지 않음 
  - 기본키를 지정하는 키워드
  - 예) PRIMARY KEY(고객아이디), PRIMARY KEY(고객아이디, 고객이름)

- UNIQUE (대체키)
  
  - 대체키를 지정하는 키워드
  - 대체키로 지정되는 속성의 값은 유일성을 가짐 
  - 기본키와 다르게 널 값이 허용된다.
  - 예) UNIQUE(고객이름)
    🚨 참조 받기 위해서 대체키를 지정해서 사용한다. 

- FOREIGN KEY (외래키)
  
  - 외래키를 지정하는 키워드
  - 외래키가 어떤 테이블의 무슨 속성을 `참조` 하는지 REFERENCES 키워드 다음에 제시
  - 참조 무결성 제약조건 유지를 위해 `참조되는 테이블에서 투플 삭제 시 처리 방법` 지정하는 옵션
  
  ```
  » ON DELETE NO ACTION: 투플을 삭제하지 못하게 함
  » ON DELETE CASCADE: 관련 투플을 함께 삭제함
  » ON DELETE SET NULL: 관련 투플의 외래키 값을 NULL로 변경함
  » ON DELETE SET DEFAULT: 관련 투플의 외래키 값을 미리 지정한 기본 값으로 변경함
  ```
  
  예) FOREIGN KEY(소속부서) REFERENCES 부서(부서번호)
    ON DELETE CASCADE ON UPDATE CASCADE

#### 데이터 무결성 제약조건의 정의

- CHECK
  - 테이블에 정확하고 유효한 데이터 유지하기 위해 특정 속성에 대한 제약조건 지정
  - CONSTRAINT 키워드와 함께 고유의 이름을 부여할 수도 있음 
  - CHECK(재고량 >= 0 AND 재고량 <= 10000)
  - CONSTRAINT CHK_CPY CHECK(제조업체 = ‘한빛제과’)

### 테이블 변경 : ALTER TABLE 문

#### 새로운 속성 추가

#### 기존 속성 삭제

🚨 만약, 삭제할 속성과 관련된 제약조건이 존재한다면?
    - 속성 삭제가 수행되지 않음
    - 관련된 제약 조건 먼저 삭제해야 함 

#### 새로운 제약조건 추가

#### 기존 제약조건 삭제

### 테이블 삭제 : DROP TABLE 문

🚨 만약, 삭제할 테이블을 참조하는 테이블이 있다면?
    - 테이블 삭제가 수행되지 않음
    - 관련된 외래키 제약 조건 먼저 삭제해야 함 

### ⭐3. SQL을 이용한 데이터 조작

#### 데이터 검색 : SELECT 문

- 기본 검색
  - SELECT 키워드와 함께 검색하고 싶은 속성 이름 나열
  - FROM 키워드와 함께 검색하고 싶은 속성이 있는 테이블의 이름을 나열
  - 검색 결과는 `테이블 형태`로 반환됨
  - ALL : 결과 테이블이 투플의 중복을 허용하도록 지정 (기본값으로 생략 가능)
  - DISTINCT : 결과 테이블이 투플의 중복을 허용하지 않도록 지정 

```sql
// 제품 테이블에서 제품명과 단가를 검색하되, 단가를 가격이라는 새 이름으로 출력해보자.


SELECT 제품명, 단가 AS 가격 
FROM 제품
```

- 산술식 이용한 검색
  
  - 속성 값이 실제로 변경되는 것이 아니라 결과 테이블에서만 계산된 결과가 출력됨
  
  ```sql
  /*
      제품 테이블에서 제품명과 단가 속성을 검색하되, 단가에 500원을 더해 
      '조정 단가'라는 새 이름으로 출력해보자.
  */
  ```
  
  SELECT 제품명, 단가+500 '조정 단가'
   FROM 제품

```
```sql
#### 조건 검색(WHERE)

조건을 만족하는 데이터만 검색하는 것으로 비교/논리 연산자 이용해 검색 조건 제시한다.




| 연산자 | 의미                      |
| --- | ----------------------- |
| AND | 모든 조건을 만족해야 검색한다        |
| OR  | 여러 조건 중 한 가지만 만족해도 검색한다 |
| NOT | 조건을 만족하지 않는 것만 검색한다     |

| 연산자    | 의미     |
| ------ | ------ |
| =      | 같다     |
| <>, != | 다르다    |
| <      | 작다     |
| >      | 크다     |
| <=     | 작거나 같다 |
| =>     | 크거나 같다 |


SELECT 제품명, 재고량, 단가 
FROM 제품
WHERE 제조업체 = '한빛제과'
```

제품 테이블에서 한빛제과가 제조한 제품의 제품명, 재고량, 단가를 검색하는 코드이다. 

- LIKE를 이용한 검색
  
  - 부분적으로 일치하는 데이터를 검색
  
  - 문자열을 이용하는 조건에만 사용
  
  | 기호  | 설명                           |
  | --- | ---------------------------- |
  | %   | 0개 이상의 문자 (문자 내용과 개수는 상관 없음) |
  | __  | 1개의 문자 (문자 내용은 상관 없음)        |

        🚨 사용 예시 

        

| 사용 예            | 설명                                      |
|:--------------- | --------------------------------------- |
| LIKE '데이터%'     | 데이터로 시작하는 문자열 (데이터로 시작하기만 하면 길이는 상관 없음) |
| LIKE '%데이터'     | 데이터로 끝나는 문자열 (데이터로 끝나기만 하면 길이는 상관 없음)   |
| LIKE '%데이터%'    | 데이터가 포함된 문자열                            |
| LIKE '데이터_ _ _' | 데이터로 시작하는 6자 길이의 문자열                    |
| LIKE '_ _한%'    | 세 번째 글자가 '한'인 문자열                       |
