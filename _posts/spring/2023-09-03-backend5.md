---
layout: single
title: "ê²Œì‹œíŒ í”„ë¡œì íŠ¸-  ë¡œê·¸ì¸ í˜ì´ì§€ ë§Œë“¤ê¸°"
categories: spring
tags: [java, spring]
sidebar:
    nav: "counts"
---

# 0. ë°°ìš¸ ë‚´ìš©

ì• ì‹œê°„ì—”  ê²Œì‹œíŒ/ê²Œì‹œê¸€ í˜ì´ì§€ ë§Œë“¤ì—ˆë‹¤.

ì˜¤ëŠ˜ì€ ë¡œê·¸ì¸ í˜ì´ì§€ ë§Œë“¤ ì˜ˆì •ì´ë‹¤.



# â­ì¶”ê°€ ì‘ì—… ì§„í–‰

user account ê´€ë ¨ ì‘ì—…ì„ ì§„í–‰í•œë‹¤. erd ë‹¤ì´ì–´ê·¸ë¨ì˜ ë‚´ìš©ì„ ì¶”ê°€ í•˜ê³ , ìœ ì € ì–´ì¹´ìš´íŠ¸ ê´€ë ¨ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•œë‹¤.

https://github.com/jyc-coder/bulletin-board/commit/28538773a77905d432ea3d1164b04c3567842cf4
ìì„¸í•œ ë‚´ìš©ì€ ì—¬ê¸°ë¥¼ ì°¸ê³ í•  ê²ƒ.

í…ŒìŠ¤íŠ¸ë¥¼ ëŒë¦¬ê³  ë‚˜ì„œ dbë¥¼ í™•ì¸í•´ë³´ë©´ ì•„ë§ˆ user_accountë¼ëŠ” í…Œì´ë¸”ì´ í•˜ë‚˜ ë” ìƒì„±ëœ ëª¨ìŠµì„ í™•ì¸ í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.



# 1. ë¡œê·¸ì¸ í˜ì´ì§€

## ğŸš¨Spring security

ìŠ¤í”„ë§ ë²„ì „ 3.0 ì´ìƒë¶€í„° security ì„ ì–¸ ë°©ë²•ì´ ë‹¬ë¼ì¡Œë‹¤...

ë¨¼ì € spring initializrì—ì„œ `ìŠ¤í”„ë§ ì›¹, thymeleaf, spring security` ë””íœë˜ì‹œ ì¶”ê°€í•´ì•¼ í•¨

ì´ ë•Œ, `thymeleaf ì™€ spring security` ë¥¼ ë™ì‹œì— ë„£ì–´ì•¼ í•¨

`build.gradle` íŒŒì¼ì— ì¶”ê°€

```java
implementation 'org.springframework.boot:spring-boot-starter-security'
implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6'
```

ì¶”ê°€ì‹œì¼œì¤€ ë’¤ localhost:8080/articles ë¡œ ë“¤ì–´ê°€ë©´,

ë¡œê·¸ì¸ ì°½ì´ ë‚˜íƒ€ë‚¨

![image-20230907103347904]({{site.url}}/images/2023-09-03-backend5/image-20230907103347904.png)

ëª»ë³´ë˜ ë¡œê·¸ì¸ ì°½ì´ ì™œ ê°‘ìê¸° ë‚˜íƒ€ë‚˜ì§€??!!

ë°”ë¡œ spring security ê¸°ëŠ¥ ë•ë¶„ì´ë‹¤.

ì´ëŸ° í˜ì´ì§€ëŠ” ë°”ë¡œ DefaultLoginPageGeneratingFilter ë¼ëŠ” ìë°” íŒŒì¼ì—ì„œ ë§Œë“¤ì–´ì§„ í˜ì´ì§€ì´ë‹¤. IDEì—ì„œ ê²€ìƒ‰í•˜ë©´ í™•ì¸í•´ ë³¼ìˆ˜ ìˆë‹¤.

ì´ íŒŒì¼ ë•ë¶„ì— ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ì €ì ˆë¡œ ë§Œë“¤ì–´ì§„ ê²ƒì€ ì¢‹ì§€ë§Œ, ë¡œê·¸ì¸ í™”ë©´ë§Œ ë³´ì´ê¸° ë•Œë¬¸ì— ë·°ì˜ ì„¤ì •ì„ ë³€ê²½í•´ë„ í™•ì¸í•´ë³¼ ìˆ˜ê°€ ì—†ëŠ” ìƒí™©ì´ ë˜ì–´ë²„ë ¸ë‹¤.

í˜„ì¬ ì¸ì¦ê¸°ëŠ¥ë„ êµ¬í˜„í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— securityconfigë¥¼ ë§Œë“¤ì–´ì„œ ì¡°ì¹˜ë¥¼ ì·¨í•´ì•¼í•œë‹¤. 

ë£¨íŠ¸ê²½ë¡œì˜ config í´ë”ì—ì„œ `SecurityConfig`ë¥¼ ìƒì„±

`SecurityConfig.java`

```java
package com.ancho.crud.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests((authz) ->authz.anyRequest().permitAll())
                .formLogin().and();
        //  Security ë²„ì „ì´ ìŠ¤í”„ë§ 3.0 ì´ìƒì—ì„œëŠ” ë³€ê²½ëœ ì ì´ ë§ì•„ì„œ ê³µì‹ ì‚¬ì´íŠ¸ë¥¼ ë³´ë©° í•´ê²°í•¨...
        return http.build();
    }
}

```

![image-20230907103630782]({{site.url}}/images/2023-09-03-backend5/image-20230907103630782.png)

ë‹¤ì‹œ ì°½ì´ ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì„ í™•ì¸í•¨

ì´ì œ ë¡œê·¸ì¸ í˜ì´ì§€ëŠ” ëë‚œê²Œ ë‹¤ê°€ ì•„ë‹ˆë¼ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ë´ì•¼ í•œë‹¤.



`ArticleControllerTest.java` ëŒë ¤ë³´ë©´ 401 ì—ëŸ¬ê°€ ë‚˜íƒ€ë‚œë‹¤.

securityConfigë¥¼ ì½ê²Œ í•  ìˆ˜ ìˆìœ¼ë©´ ì˜¤ë¥˜ê°€ ìƒê¸°ì§€ ì•Šìœ¼ë¯€ë¡œ

ìœ„ íŒŒì¼ì— `@Import(SecurityConfig.class)` ì½”ë“œë¥¼ ì¶”ê°€í•œë‹¤.

``` java
@DisplayName("View ì»¨íŠ¸ë¡¤ëŸ¬ - ê²Œì‹œê¸€")
@Import(SecurityConfig.class)	//	ì‹œíë¦¬í‹° ì½ì–´ì˜¤ê²Œ í•¨
@WebMvcTest(ArticleController.class)    //  ì…ë ¥í•œ í…ŒìŠ¤íŠ¸ë§Œ ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•˜ê²Œ í•¨ 
```



## ë¡œê·¸ì¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸ ì¶”ê°€

`test/controller/AutoControllerTest.java` íŒŒì¼ ìƒì„±

```java
package com.ancho.crud.controller;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@DisplayName("View ì»¨íŠ¸ë¡¤ëŸ¬ - ì¸ì¦")
@Import(SecurityConfig.class)
@WebMvcTest
public class AuthControllerTest {

    private final MockMvc mvc;

    public AuthControllerTest(@Autowired MockMvc mvc) {  //  testì— ìˆëŠ” ìƒì„±ìê°€ í•˜ë‚˜ë¼ë©´ ë°˜ë“œì‹œ @Autowired ì„ ì–¸ í•´ì•¼ í•¨
        this.mvc = mvc;
    }

    @DisplayName("[view][GET] ë¡œê·¸ì¸ í˜ì´ì§€ - ì •ìƒ í˜¸ì¶œ")
    @Test
    public void givenNothing_whenTryingToLogIn_thenReturnsLogInView() throws Exception {
        //  Given

        //  When & Then
        mvc.perform(get("/login"))  //  í˜ì´ì§€ ìš”ì²­
                .andExpect(status().isOk()) //  ì •ìƒ í˜¸ì¶œ
                .andExpect(content().contentTypeCompatibleWith(MediaType.TEXT_HTML));  //  ë°ì´í„° í™•ì¸
    }
}

```

í…ŒìŠ¤íŠ¸ ì„±ê³µ



ë””ìì¸ì„ ë¶™ì´ëŠ” ë°©ë²•ì€ ì•„ë˜ ë§í¬ ì°¸ì¡°

https://velog.io/@jhs000123/%EA%B2%8C%EC%8B%9C%ED%8C%90-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EB%B7%B0%EC%97%90-%EB%94%94%EC%9E%90%EC%9D%B8-%EB%B6%99%EC%9D%B4%EA%B8%B0
