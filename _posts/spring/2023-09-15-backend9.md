---
layout: single
title: "ê²Œì‹œíŒ í”„ë¡œì íŠ¸-  ê²Œì‹œíŒ í˜ì´ì§€ë„¤ì´ì…˜"
categories: spring
tags: [java, spring]
sidebar:
    nav: "counts"
---

# 1. í˜ì´ì§• ë°” ê¸°ìˆ  êµ¬í˜„

ê²Œì‹œê¸€ì„ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„ì„ í–ˆì§€ë§Œ ê²Œì‹œíŒ í˜ì´ì§•ì„ êµ¬í˜„í•˜ì§€ ì•Šì•„ì„œ í˜„ì¬ëŠ” í•œ í˜ì´ì§€ì˜ ê²Œì‹œê¸€ë§Œ ë³¼ ìˆ˜ ìˆëŠ” ìƒíƒœì´ë‹¤.
ìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê²Œì‹œíŒ í˜ì´ì§•ì„ êµ¬í˜„í•œë‹¤. 

ê²Œì‹œíŒ í˜ì´ì§• ë°” ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ `PaginationService` ì™€ Test íŒŒì¼ë„ ìƒì„±í•œë‹¤. 

## í˜ì´ì§• ë°” ë¦¬ìŠ¤íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸

í˜„ì¬ í˜ì´ì§€ì˜ ìˆ«ìê°€ í˜ì´ì§• ë°”ì˜ ê°€ìš´ë°ì— ìœ„ì¹˜í•˜ê²Œ ì„¤ì •í•œë‹¤. 
ë§¤ í˜ì´ì§€ë§ˆë‹¤ í˜ì´ì§€ë„¤ì´ì…˜ ìˆ«ìë¥¼ ê³„ì‚°í•´ ë°”ë¥¼ ê·¸ë ¤ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ê¸°ë¡œ ê²°ì •í•¨

êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ ë‹¤ì–‘í•˜ì§€ë§Œ ì´ë²ˆì—ëŠ” `ìŠ¤í”„ë§ì˜ ì„œë¹„ìŠ¤ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ë¹ˆìœ¼ë¡œì¨ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼` í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤.

[êµ¬í˜„ ìˆœì„œ]
1. `PaginationService` íŒŒì¼ ìƒì„±í•œ ë’¤, í…ŒìŠ¤íŠ¸ íŒŒì¼ë„ ìƒì„±í•œë‹¤. 
2. í˜ì´ì§€ë„¤ì´ì…˜ ë°”ì˜ ê¸¸ì´ë¥¼ ê³ ì • ìƒìˆ˜ë¡œ ì •í•œë‹¤. 
3. í˜ì´ì§€ë„¤ì´ì…˜ ë°”ì˜ í˜„ì¬ ìˆ«ìì™€ ì´ í˜ì´ì§€ ìˆ˜ë¥¼ return í•˜ëŠ” ë©”ì†Œë“œ, ê³ ì •ìƒìˆ˜ì¸ Barì˜ ê¸¸ì´ë¥¼ ê°€ì ¸ì˜¤ëŠ” getter êµ¬í˜„ 

ìœ„ì˜ ìˆœì„œë¥¼ ì´ìš©í•´ ì•„ë˜ì˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ë‹¤. 

### ğŸ–¥ PaginationService
```Java
@Service
public class PaginationService {
//      í˜ì´ì§€ë„¤ì´ì…˜ ì„œë¹„ìŠ¤

//        í˜ì´ì§€ ë„¤ì´ì…˜ì˜ ê¸¸ì´ë¥¼ ìƒíƒœê°’ìœ¼ë¡œ ì •í•´ì„œ ì•Œì•„ë‚¸ë‹¤.
    private static final int BAR_LENGTH = 5;

//      í˜„ì¬ ì–´ëŠ í˜ì´ì§€ ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ currentPageNumber ë³€ìˆ˜ë¡œ í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì½ì–´ì˜¨ë‹¤.
//     ë§ˆì§€ë§‰ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì•Œì•„ë‚´ì•¼ í•˜ê¸° ë•Œë¬¸ì— totlaPagesë¡œ ì „ì²´ í˜ì´ì§€ ìˆ˜ë¥¼ ì•Œì•„ë‚¸ë‹¤.
    public List<Integer> getPaginationBarNumbers(int currentPageNumber, int totalPages) {
        int startNumber = Math.max(currentPageNumber - (BAR_LENGTH / 2), 0);
        int endNumber = Math.min(startNumber + BAR_LENGTH, totalPages);

        return IntStream.range(startNumber, endNumber).boxed().toList();
    }

    public int currentBarLength(){
        return BAR_LENGTH;
    }
}
```

í˜ì´ì§• ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìƒê°í•´ë³´ì.


## 1. í˜ì´ì§• ë°” ë¦¬ìŠ¤íŠ¸ ìƒì„±

```java
@DisplayName("í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ì™€ ì´ í˜ì´ì§€ ìˆ˜ë¥¼ ì£¼ë©´, í˜ì´ì§• ë°” ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.")
    //  @Test ëŒ€ì‹  ë©”ì†Œë“œ ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
    //  êµ¬í˜„í•˜ëŠ” ë°©ë²•ì—ëŠ” voidí•¨ìˆ˜ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•œ ë’¤ static í•¨ìˆ˜ì´ë¦„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•œë‹¤.
    @MethodSource
    @ParameterizedTest(name = "[{index}] í˜„ì¬ í˜ì´ì§€ : {0}, ì´ í˜ì´ì§€ : {1} => {2}")
//    int currentPageNumber => í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
//    int totalPages => ì´ í˜ì´ì§€ ìˆ˜
//    List<Integer> expected => ê²€ì¦í•˜ê³  ì‹¶ì€ ê°’
    void givenCurrentPageNumberAndTotalPages_whenCalculating_thenReturnsPaginationBarNumbers(int currentPageNumber, int totalPages, List<Integer> expected){
        //  Given

        //  When
        //  ì‹¤ì œ ê°’ => actual ì„ ì´ìš©í•´ í˜ì´ì§• ë°” ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•œë‹¤.
        List<Integer> actual = sut.getPaginationBarNumbers(currentPageNumber, totalPages);

        //  Then
        assertThat(actual).isEqualTo(expected);
    }

    static Stream<Arguments> givenCurrentPageNumberAndTotalPages_whenCalculating_thenReturnsPaginationBarNumbers() {
        return Stream.of(
                //  ë‚´ê°€ ê²€ì¦í•˜ê³  ì‹¶ì€ ê°’ì„ ë‚˜ì—´í•¨
                //  arguments(í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸, ì´ í˜ì´ì§€ ìˆ˜, ë‚˜ì™€ì•¼í•˜ëŠ” í˜ì´ì§• ë²ˆí˜¸)
                arguments(0, 13, List.of(0, 1, 2, 3, 4)),
                arguments(1, 13, List.of(0, 1, 2, 3, 4)),
                arguments(2, 13, List.of(0, 1, 2, 3, 4)),
                arguments(3, 13, List.of(1, 2, 3, 4, 5)),
                arguments(4, 13, List.of(2, 3, 4, 5, 6)),
                arguments(5, 13, List.of(3, 4, 5, 6, 7)),
                arguments(6, 13, List.of(4, 5, 6, 7, 8)),
                arguments(10, 13, List.of(8, 9, 10, 11, 12)),
                arguments(11, 13, List.of(9, 10, 11, 12)),
                arguments(12, 13, List.of(10, 11, 12))
        );
    }
```

ì´ í˜ì´ì§€ ìˆ˜ë¥¼ 13ìœ¼ë¡œ ì§€ì •í•œ ì´ìœ ëŠ” í…ŒìŠ¤íŠ¸ ë°ì´í„° ì•ˆì— ê²Œì‹œê¸€ì´ 123ê°œ ìˆê¸° ë•Œë¬¸ì— ê²Œì‹œê¸€ 10ê°œì— í•œ í˜ì´ì§€ë¼ê³  ìƒê°í•˜ë©´ ì´ 13ê°œì˜ í˜ì´ì§€ê°€ ìƒì„±ë˜ê¸° ë•Œë¬¸ì´ë‹¤.
í•˜ì§€ë§Œ currentPageNumberëŠ” ì¸ë±ìŠ¤ë¡œ 0ë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì„ ì•Œê³  ìˆì–´ì•¼ í•œë‹¤. 

## 2. í˜ì´ì§€ë„¤ì´ì…˜ ë°”ì˜ ê¸¸ì´ë¥¼ ì•Œë ¤ì£¼ëŠ” í…ŒìŠ¤íŠ¸
```Java
@DisplayName("í˜„ì¬ ì„¤ì •ë˜ì–´ ìˆëŠ” í˜ì´ì§€ë„¤ì´ì…˜ ë°”ì˜ ê¸¸ì´ë¥¼ ì•Œë ¤ì¤€ë‹¤.")
    @Test
    void givenNothing_whenCalling_thenReturnsCurrentBarLength(){
        //  Given

        //  When
        //  ë°”ì˜ ê¸¸ì´ ê°’ => barLength ì„ ì´ìš©í•´ ë°”ì˜ ê¸¸ì´ë¥¼ ì•Œë ¤ì¤€ë‹¤.
        int barLength = sut.currentBarLength();

        //  Then
        assertThat(barLength).isEqualTo(5);
    }
```

# 2. ì»¨íŠ¸ë¡¤ëŸ¬ì— ì„œë¹„ìŠ¤ ì ìš©ì‹œí‚¤ê¸°

ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜ì´ì§€ë„¤ì´ì…˜ ë‚´ìš©ì„ ì ìš©ì‹œí‚¨ë‹¤.
`ArticleControllerTest` ì—ì„œ @MockBean ìœ¼ë¡œ `PaginationService`ë¥¼ ì¶”ê°€í•˜ê³  í˜ì´ì§• ê´€ë ¨ ë‚´ìš©ì— í•´ë‹¹í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.
```Java
@MockBean private PaginationService paginationService;  //  í˜ì´ì§€ë„¤ì´ì…˜ ì„œë¹„ìŠ¤ ì¶”ê°€
```

## ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ (`ArticleControllerTest` ìˆ˜ì •)

```java
@DisplayName("[view][GET] ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ (ê²Œì‹œíŒ) í˜ì´ì§€ - ì •ìƒ í˜¸ì¶œ")
    @Test
    public void givenNothing_whenRequestingArticlesView_thenReturnsArticlesView() throws Exception {
        //  Given
        given(articleService.searchArticles(eq(null), eq(null), any(Pageable.class))).willReturn(Page.empty());
        given(paginationService.getPaginationBarNumbers(anyInt(), anyInt())).willReturn(List.of(0,1, 2, 3, 4));
        //  When & Then
        mvc.perform(get("/articles"))
                .andExpect(status().isOk()) //  ì •ìƒ í˜¸ì¶œ
                .andExpect(content().contentTypeCompatibleWith(MediaType.TEXT_HTML))  //  ë°ì´í„° í™•ì¸
                .andExpect(view().name("articles/index"))   //  ë·° ì´ë¦„ ê²€ì‚¬
                .andExpect(model().attributeExists("articles"))    // ë·°ì— ëª¨ë¸ ì–´íŠ¸ë¦¬ë·°íŠ¸ë¡œ ë„£ì–´ì¤€ ë°ì´í„°ì¡´ì¬ ì—¬ë¶€ ê²€ì‚¬
                .andExpect(model().attributeExists("paginationBarNumbers"));    // í˜ì´ì§€ë„¤ì‹œì…˜ ë°” ìˆ«ì ë„˜ê²¨ì¤Œ
        then(articleService).should().searchArticles(eq(null), eq(null), any(Pageable.class));
        then(paginationService).should().getPaginationBarNumbers(anyInt(), anyInt());
    }
```

given(paginationService.getPaginationBarNumbers(anyInt(), anyInt())).willReturn(List.of(0,1, 2, 3, 4));
ì´ë•Œ, anyInt()ë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” ê·¸ëƒ¥ anyë¡œ í•´ì£¼ë©´ null ê°’ë„ ì…ë ¥ê°’ì´ ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

then(paginationService).should().getPaginationBarNumbers(anyInt(), anyInt());	=> ë©”ì†Œë“œê°€ í˜¸ì¶œ ë˜ì—ˆëŠ”ì§€ í™•ì¸


## ì»¨íŠ¸ë¡¤ëŸ¬ì— ì„œë¹„ìŠ¤ ì¶”ê°€ ë° ë‚´ìš© ìˆ˜ì •

ì»¨íŠ¸ë¡¤ëŸ¬ì— í˜ì´ì§€ë„¤ì´ì…˜ ì„œë¹„ìŠ¤ë¥¼ ì˜ì¡´ì„±ì— ì¶”ê°€í•˜ê³  ë§¤í•‘ ë‚´ìš©ì„ ìˆ˜ì •í•œë‹¤. 
í˜„ì¬ map.addAttributeë¥¼ í†µí•´ articles ë¼ëŠ” ì–´íŠ¸ë¦¬ë·°íŠ¸ ì´ë¦„ì„ ê°€ì§„ Pageableì´ ì¡´ì¬í•œë‹¤. 

í•´ë‹¹ PageëŠ” ArticleResponseì—ì„œ ë‚´ë³´ë‚´ì§„ ê²ƒìœ¼ë¡œ articleì„œë¹„ìŠ¤ì—ì„œ searchArticlesë©”ì†Œë“œ í˜¸ì¶œëœí›„ ë§¤í•‘ëœ ê°’ìœ¼ë¡œ ë§¨ì•ìœ¼ë¡œ ìˆœì„œë¥¼ ì˜®ê¸¸ìˆ˜ ìˆë‹¤.
ê·¸ë‹¤ìŒ paginationBarNumbers ì–´íŠ¸ë¦¬ë·°íŠ¸ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•œ barNumbersë¥¼ paginationServiceì—ì„œ getPaginationBarNumbersë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë’¤ ë‚˜íƒ€ë‚˜ëŠ” ê²°ê³¼ê°’ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì •ì˜í•œë‹¤. ì´ë•Œ íŒŒë¼ë¯¸í„°ëŠ” pageableì—ì„œ í˜ì´ì§€ë²ˆí˜¸ì™€ , articlesì—ì„œ getTotalPages()ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œ ê°’ì´ í•´ë‹¹ë  ê²ƒì´ë‹¤. (getPaginationBarNumbersë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ëŠ” í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ì™€ ì´ í˜ì´ì§€ì˜ ìˆ˜, ì´ë ‡ê²Œ 2ê°€ì§€ì˜€ê¸° ë•Œë¬¸ì´ë‹¤.)

ê·¸ëŸ¼ì´ì œ í…ŒìŠ¤íŠ¸ì—ì„œ ì¡´ì¬ì—¬ë¶€ë¥¼ íŒŒì•…í•˜ì§€ ëª»í•œ paginationBarNumbers ì–´íŠ¸ë¦¬ë·°íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤. ì´ë•Œ ëŒ€ìƒì€ ë°”ë¡œ barNubmers ë¦¬ìŠ¤íŠ¸ì´ë‹¤.

### ğŸ–¥ ArticleController.java

```Java
 @GetMapping
    public String articles(
            @RequestParam(required = false) SearchType searchType,
            @RequestParam(required = false) String searchValue,
            @PageableDefault(size = 10, sort ="createdAt", direction = Sort.Direction.DESC) Pageable pageable,
            ModelMap map) {
        Page<ArticleResponse> articles =  articleService.searchArticles(searchType,searchValue,pageable).map(ArticleResponse::from);
        List<Integer> barNumbers = paginationService.getPaginationBarNumbers(pageable.getPageNumber(),articles.getTotalPages());
        map.addAttribute("articles", articles);
        map.addAttribute("paginationBarNumbers",barNumbers);

        return "articles/index";
    }
```

# 3. ë·° ì ìš©

![image-20230915214104799]({{site.url}}/images/2023-09-15-backend9/image-20230915214104799.png)



123ê°œì˜ ê²Œì‹œê¸€ì„ ì „ë¶€ ë³¼ ìˆ˜ ìˆë‹¤. ê²Œì‹œíŒì˜ í˜ì´ì§€ë„¤ì´ì…˜ì€ ëª¨ë‘ êµ¬í˜„ í•˜ì˜€ë‹¤.



```html
<attr sel="#pagination">
        <attr sel="li[0]/a"
              th:text="'previous'"
              th:href="@{/articles(page=${articles.number - 1})}"
              th:class="'page-link' + (${articles.number} <= 0 ? ' disabled' : '')"
		/>
        <attr sel="li[1]" th:class="page-item" th:each="pageNumber : ${paginationBarNumbers}">
            <attr sel="a"
                  th:text="${pageNumber + 1}"
                  th:href="@{/articles(page=${pageNumber})}"
                  th:class="'page-link' + (${pageNumber} == ${articles.number} ? ' disabled' : '')"
            />
        </attr>
        <attr sel="li[2]/a"
              th:text="'next'"
              th:href="@{/articles(page=${articles.number + 1})}"
              th:class="'page-link' + (${articles.number} >= ${articles.totalPages - 1} ? ' disabled' : '')"
        />
</attr>
```



